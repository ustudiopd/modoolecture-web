좋아. “10개 토픽”을 **그대로 태그 시스템**으로 쓸 수 있게, **(1) 태그 스키마**, **(2) LLM(Gemini API) 분류 프롬프트**, **(3) JSON 출력 규격**, **(4) 운영용 보조 규칙(무응답/멀티태그/신뢰도)**까지 한 번에 정리해줄게.
(이건 Next.js Route Handler로 붙이기 딱 좋고, Supabase에 저장/필터링도 쉬운 형태야.  )

---

## 1) 태그 스키마 (고정 enum)

### Topic Tag (10개, 고정)

```ts
export type QuestionTopicTag =
  | "none"                 // 무응답/의미없음
  | "getting_started"      // 입문/일반 활용/시작
  | "workflow_automation"  // 실무 적용/자동화/워크플로
  | "prompting"            // 프롬프트/질문법
  | "tools_models"         // 툴/모델 선택·비교·연동
  | "accuracy_verification"// 정확도/환각/검증
  | "security_privacy"     // 보안/개인정보/사내정책
  | "copyright_ethics"     // 저작권/윤리/표절/출처
  | "cost_roi"             // 비용/구독/ROI
  | "trends_learning_career"; // 트렌드/학습/미래·커리어
```

### Intent Tag (선택이지만 강추: 운영이 훨씬 쉬워짐)

```ts
export type QuestionIntentTag =
  | "howto"        // 방법/가이드 요청
  | "recommend"    // 추천/비교/선택
  | "troubleshoot" // 문제/불편/장애
  | "explain"      // 개념/원리 이해
  | "strategy"     // 전략/전망/의사결정
  | "other";       // 애매함
```

---

## 2) Gemini가 반드시 지켜야 할 “출력 JSON 규격”

**중요:** “태그를 무조건 하나로만” 하지 말고

* `primary_topic` 1개 고정
* `secondary_topics` 0~2개 허용
  으로 가야 실제 질문이 안 깨져요.

```json
{
  "primary_topic": "workflow_automation",
  "secondary_topics": ["tools_models", "prompting"],
  "intent": "howto",
  "confidence": 0.82,
  "reason_short": "업무 자동화 방법을 묻고 있으며 도구/프롬프트 언급 가능성이 높음",
  "keywords": ["자동화", "보고서", "업무"],
  "should_route_to": "ops" 
}
```

* `confidence`: 0~1
* `should_route_to`: 운영에서 쓰기 좋게 3가지 정도로만

  * `"ops"`(운영에서 바로 처리/답변)
  * `"expert"`(보안/저작권/정확도 이슈로 전문가 확인 필요)
  * `"ignore"`(none/스팸/의미없음)

---

## 3) Gemini 분류용 “시스템 프롬프트”(복붙용)

> 아래 프롬프트를 그대로 **Gemini API의 system / instruction**에 넣고, user에는 질문 텍스트만 넣으면 됨.

```text
You are a strict classifier for Korean audience questions.
Classify a single question into topic tags and intent tag.
Return ONLY valid JSON. No markdown. No extra text.

Rules:
1) Choose exactly 1 primary_topic from the allowed list.
2) Choose 0 to 2 secondary_topics from the same allowed list, excluding primary_topic.
3) Choose exactly 1 intent from the allowed list.
4) If the question is empty, only punctuation, or meaningless (e.g., "없음", "...", "-"), set primary_topic="none", intent="other", confidence>=0.95, should_route_to="ignore".
5) confidence must be a number 0..1.
6) reason_short must be <= 40 Korean characters.
7) keywords: up to 5 short keywords extracted from the question.

Allowed primary_topic/secondary_topics:
- none
- getting_started
- workflow_automation
- prompting
- tools_models
- accuracy_verification
- security_privacy
- copyright_ethics
- cost_roi
- trends_learning_career

Allowed intent:
- howto
- recommend
- troubleshoot
- explain
- strategy
- other

Routing:
- should_route_to="ignore" if primary_topic="none"
- should_route_to="expert" if primary_topic is security_privacy or copyright_ethics (unless confidence < 0.55 then ops)
- otherwise should_route_to="ops"

Output JSON schema:
{
  "primary_topic": "...",
  "secondary_topics": ["..."],
  "intent": "...",
  "confidence": 0.0,
  "reason_short": "...",
  "keywords": ["..."],
  "should_route_to": "ops|expert|ignore"
}
```

---

## 4) 태그 경계(운영자/모델 둘 다 헷갈리는 지점) 정리

### ✅ getting_started vs trends_learning_career

* **getting_started**: “지금 당장 어떻게 시작?” / “뭐부터?”
* **trends_learning_career**: “업데이트 따라잡기/학습 로드맵/직업 영향/미래”

### ✅ workflow_automation vs prompting

* **workflow_automation**: “업무/프로세스/자동화/문서/보고서 만들기”
* **prompting**: “질문을 어떻게 써야 원하는 답이 나옴?”

### ✅ tools_models vs cost_roi

* **tools_models**: “ChatGPT vs Gemini vs Claude, API, 연동”
* **cost_roi**: “구독비, 비용, 무료 대안, 효율”

### ✅ accuracy_verification vs copyright_ethics

* **accuracy_verification**: “틀린 답, 근거, 팩트체크”
* **copyright_ethics**: “출처, 표절, 생성물 사용 가능?, 윤리”

---

## 5) Supabase 저장 구조(추천)

`questions` 테이블에 아래 칼럼 추가만으로 충분:

* `primary_topic text`
* `secondary_topics text[]`
* `intent text`
* `confidence float4`
* `classified_by text` (`gemini` | `human` | `rule`)
* `category_version int` (나중에 분류 체계 바뀔 때 재분류 추적)

멀티테넌시/웨비나 데이터 흐름은 이미 `webinar_id` 기준으로 잘 되어 있으니, 태그만 붙이면 바로 운영 콘솔에서 필터링 가능해요.  

---

원하면 다음 단계로, **Next.js Route Handler 예시(`/api/questions/classify`)**랑
**Gemini 결과를 questions에 업데이트하는 트랜잭션 흐름**까지 “바로 붙여넣어 쓸” 코드 형태로 만들어줄게.
